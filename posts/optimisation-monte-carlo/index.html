<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Portfolio Optimisation: Monte Carlo method" /><meta name="author" content="Ben Postance" /><meta property="og:locale" content="en_US" /><meta name="description" content="Jupyter notebook here" /><meta property="og:description" content="Jupyter notebook here" /><link rel="canonical" href="https://bpostance.github.io/posts/optimisation-monte-carlo/" /><meta property="og:url" content="https://bpostance.github.io/posts/optimisation-monte-carlo/" /><meta property="og:site_name" content="Ben Postance" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-08-04T19:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Portfolio Optimisation: Monte Carlo method" /><meta name="twitter:site" content="@benpostance" /><meta name="twitter:creator" content="@Ben Postance" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Ben Postance"},"dateModified":"2021-04-19T20:54:48+01:00","datePublished":"2020-08-04T19:00:00+01:00","description":"Jupyter notebook here","headline":"Portfolio Optimisation: Monte Carlo method","mainEntityOfPage":{"@type":"WebPage","@id":"https://bpostance.github.io/posts/optimisation-monte-carlo/"},"url":"https://bpostance.github.io/posts/optimisation-monte-carlo/"}</script><title>Portfolio Optimisation: Monte Carlo method | Ben Postance</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> // see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> MathJax = { tex: { inlineMath: [ // start/end delimiter pairs for in-line math ['$','$'], ['\\(','\\)'] ], displayMath: [ // start/end delimiter pairs for display math ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-140894462-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-140894462-1'); }); </script><body data-spy="scroll" data-target="#toc"><div id="top"></div><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/7165735?s=460&u=7ca34b8152bbff087bfc860cc87a4c35b4f9cb1b&v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Ben Postance</a></div><div class="site-subtitle font-italic">Risk, Data Science and Machine Learning</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT ME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/bpostance" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/benpostance" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['benpostance','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Portfolio Optimisation: Monte Carlo method</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Portfolio Optimisation: Monte Carlo method</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Ben Postance </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Aug 4, 2020, 7:00 PM +0100" prep="on" > Aug 4, 2020 <i class="unloaded">2020-08-04T19:00:00+01:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Mon, Apr 19, 2021, 8:54 PM +0100" prefix="Updated " > Apr 19, 2021 <i class="unloaded">2021-04-19T20:54:48+01:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1081 words">6 min</span></div></div><div class="post-content"><p><strong><a href="https://github.com/bpostance/dsc.learn/blob/main/optimization/investments/00-portfolio-optimisation-monte-carlo-v0.0.ipynb">Jupyter notebook here</a></strong></p><p><em>Given a fixed amount of avliable resources, optimise allocation to maximise returns across a set of products with variable returns.</em></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://cdn-images-1.medium.com/max/1000/1*QBQXfHZxYzAsbZGqAxa9nw.jpeg" width="500" height="300" /></p><p>Following the Modern Portfolio Theory model <a href="https://pubsonline.informs.org/doi/abs/10.1287/mnsc.3.3.255">(Markowitz 1957)</a> we can formulate this problem as:</p><p><em>Given a fixed quantity of money (say $1000), how much should we invest in a series of stocks so as to (a) have a one month expected return of at least a given threshold, and (b) minimize the risk (variance) of the portfolio return.</em></p><h3 id="solution-using-monte-carlo">Solution using Monte Carlo</h3><p>Monte Carlo (MC) based solutions encompass a wide array of algorithms that exploit repeat random sampling and uncertainty to solve large, complex and generally intractable mathematical problems. MC is akin to exhaustive search type solutions. However in MC framed problems, the input model parameters, initial, boundary and environmental conditions are unknown and or subject to a degree of uncertainty. Therefore a true exahuastive search is not possible. The aim of MC is to conduct repeat random sampling of the input space to generate large numbers (e.g. $n$ = 100,000) of “plausible realities” from which metrics, risk analyses, and further assessments are drawn. Thus one of the most challenging aspects of the monte carlo method is in determining accuracte covariances and probability distributions of the input parameter space.</p><p>Lets make some simplifying assumptions:</p><ul><li>We have \$1000 to invest $V$.<li>The risk-free rate is 0.03 (3 %). This is the return we can garuntee by instead putting our money in a savings account.<li>Stocks have a known and fixed starting price.<li>The monthly returns of a stock follow a standard normal distribution.</ul><p><strong><em>Stocks</em></strong></p><p>First let’s define some stocks that are avaliable to invest in. For simplicity the stocks are heuristically assignined with a range of average daily return $mu$ and volatility $sigma$ values. For a more realistic simulation, one could derive these values from actual investment instruments. The average return and volatility of each stock is summarised in the table and figure 1.</p><div><style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; }</style><table border="1" class="dataframe"><thead><tr style="text-align: right;"><th><th>n<th>name<th>price<th>mu<th>sigma<tbody><tr><th>0<td>0<td>jumanji inc<td>10<td>0.10<td>10<tr><th>1<td>1<td>evolution ltd<td>20<td>0.20<td>20<tr><th>2<td>2<td>the incredibles inc<td>30<td>0.30<td>30<tr><th>3<td>3<td>men in black &amp; co<td>20<td>0.08<td>40<tr><th>4<td>4<td>goldmember gmbh<td>50<td>0.05<td>15<tr><th>5<td>5<td>dantes peak<td>10<td>0.25<td>20<tr><th>6<td>6<td>deep impact<td>20<td>0.02<td>5</table></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2020-08-04-portfolios-fig1.png" alt="png" /></p><p><strong><em>Random Portfolio’s</em></strong></p><p>The second step is to generate random portfolios of value upto a maximum value of \(V\), the total funds avaliable to invest. The method applied is adapted from this <a href="https://stackoverflow.com/a/36818198/4538066">SO</a> answer but is not optimal in terms of performance.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="c1"># total number of stocks in universe
</span><span class="n">N</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">stocks</span><span class="p">)</span> 

<span class="c1"># V = total to invest 
</span><span class="n">investment</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="mi">3</span> 
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">Investment: $</span><span class="si">{</span><span class="n">investment</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span>
      
<span class="n">mc_portfolio_runs</span> <span class="o">=</span> <span class="nf">list</span><span class="p">()</span>
<span class="n">pmax</span><span class="o">=</span><span class="mi">5000</span>
<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">pmax</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="n">pmax</span><span class="si">}</span><span class="sh">'</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="sh">'</span><span class="se">\r</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="c1"># random portfolio size
</span>    <span class="n">portfolio_size</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> 

    <span class="c1"># create a df portfolio of them
</span>    <span class="n">df</span> <span class="o">=</span> <span class="n">stocks_df</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">choice</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">portfolio_size</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="bp">False</span><span class="p">)].</span><span class="nf">copy</span><span class="p">()</span>

    <span class="c1"># sum numbers
</span>    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">random</span><span class="p">(</span><span class="n">portfolio_size</span><span class="p">)</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">].</span><span class="nf">sum</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">T</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="k">break</span>

    <span class="c1"># calculate normalised value and number of shares 
</span>    <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">]</span> <span class="o">*=</span> <span class="n">investment</span><span class="o">/</span><span class="n">T</span>
    <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">shares</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">price</span><span class="sh">'</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">p</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
    
    <span class="n">mc_portfolio_runs</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></table></code></div></div><p>Here we can see the investments in portfolio 0.</p><div><style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; }</style><table border="1" class="dataframe"><thead><tr style="text-align: right;"><th><th>n<th>name<th>price<th>mu<th>sigma<th>value<th>shares<th>p<tbody><tr><th>0<td>3<td>men in black &amp; co<td>20<td>0.08<td>40<td>201.353368<td>10.067668<td>0<tr><th>1<td>6<td>deep impact<td>20<td>0.02<td>5<td>19.906906<td>0.995345<td>0</table></div><p><strong><em>Balanced Portfolio</em></strong></p><p>We also create A balanced portfolio. This provides a usefull benchamrk and represents the strategy of investing in each stock equally.</p><div><style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; }</style><table border="1" class="dataframe"><thead><tr style="text-align: right;"><th><th>n<th>name<th>price<th>mu<th>sigma<th>value<th>shares<th>p<tbody><tr><th>0<td>0<td>jumanji inc<td>10<td>0.10<td>10<td>333.33<td>33.3330<td>balanced<tr><th>1<td>1<td>evolution ltd<td>20<td>0.20<td>20<td>333.33<td>16.6665<td>balanced<tr><th>2<td>2<td>the incredibles inc<td>30<td>0.30<td>30<td>333.33<td>11.1110<td>balanced<tr><th>3<td>3<td>men in black &amp; co<td>20<td>0.08<td>40<td>333.33<td>16.6665<td>balanced<tr><th>4<td>4<td>goldmember gmbh<td>50<td>0.05<td>15<td>333.33<td>6.6666<td>balanced<tr><th>5<td>5<td>dantes peak<td>10<td>0.25<td>20<td>333.33<td>33.3330<td>balanced<tr><th>6<td>6<td>deep impact<td>20<td>0.02<td>5<td>333.33<td>16.6665<td>balanced</table></div><p><strong><em>Calculate Portfolio Risk &amp; Return</em></strong></p><p>Third, we define and execute a function to calculate the return, risk, and Sharpe ratio of each random portfolio and the balance portfolio. The <a href="https://www.investopedia.com/terms/s/sharperatio.asp">Sharpe ratio</a> is defined as the return earned in excess of the risk free rate (e.g. fixed rate saving account).</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">portfolio_returns</span><span class="p">(</span><span class="n">portfolio</span><span class="p">,</span><span class="n">risk_free_rate</span><span class="o">=</span><span class="mf">0.03</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    Calculates portfolio returns, risk and summary
    </span><span class="sh">"""</span>
    <span class="c1">#calculate returns
</span>    <span class="n">portfolio</span><span class="p">[</span><span class="sh">'</span><span class="s">result</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">portfolio</span><span class="p">[</span><span class="sh">'</span><span class="s">mu</span><span class="sh">'</span><span class="p">],</span><span class="n">scale</span><span class="o">=</span><span class="n">portfolio</span><span class="p">[</span><span class="sh">'</span><span class="s">sigma</span><span class="sh">'</span><span class="p">])</span><span class="o">*</span><span class="n">portfolio</span><span class="p">[</span><span class="sh">'</span><span class="s">shares</span><span class="sh">'</span><span class="p">]</span>

    <span class="c1"># calculate risk
</span>    <span class="c1"># https://math.stackexchange.com/questions/3381762/how-to-combine-standard-deviations-using-variance
</span>    <span class="c1"># sqrt((sum(var1^2+var2^2)))
</span>    <span class="n">portfolio</span><span class="p">[</span><span class="sh">'</span><span class="s">var</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">portfolio</span><span class="p">[</span><span class="sh">'</span><span class="s">sigma</span><span class="sh">'</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="c1"># portfolio summary
</span>    <span class="n">portfolio_summary</span> <span class="o">=</span> <span class="n">portfolio</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">'</span><span class="s">p</span><span class="sh">'</span><span class="p">).</span><span class="nf">agg</span><span class="p">({</span><span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">:</span><span class="nb">sum</span><span class="p">,</span><span class="sh">'</span><span class="s">var</span><span class="sh">'</span><span class="p">:</span><span class="nb">sum</span><span class="p">,</span><span class="sh">'</span><span class="s">result</span><span class="sh">'</span><span class="p">:</span><span class="nb">sum</span><span class="p">})</span>
    <span class="n">portfolio_summary</span><span class="p">[</span><span class="sh">'</span><span class="s">return</span><span class="sh">'</span><span class="p">]</span><span class="o">=</span> <span class="p">((</span><span class="n">portfolio_summary</span><span class="p">[</span><span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">]</span><span class="o">+</span><span class="n">portfolio_summary</span><span class="p">[</span><span class="sh">'</span><span class="s">result</span><span class="sh">'</span><span class="p">])</span><span class="o">/</span><span class="n">portfolio_summary</span><span class="p">[</span><span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">])</span><span class="o">*</span><span class="mf">100.0</span>
    <span class="n">portfolio_summary</span><span class="p">[</span><span class="sh">'</span><span class="s">risk</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">portfolio_summary</span><span class="p">[</span><span class="sh">'</span><span class="s">var</span><span class="sh">'</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span>
    
    <span class="n">portfolio_summary</span><span class="p">[</span><span class="sh">'</span><span class="s">sharpe</span><span class="sh">'</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">portfolio_summary</span><span class="p">[</span><span class="sh">'</span><span class="s">return</span><span class="sh">'</span><span class="p">]</span><span class="o">-</span><span class="n">risk_free_rate</span><span class="p">)</span><span class="o">/</span><span class="n">portfolio_summary</span><span class="p">[</span><span class="sh">'</span><span class="s">risk</span><span class="sh">'</span><span class="p">]</span>
    <span class="n">portfolio_summary</span><span class="p">.</span><span class="nf">drop</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">var</span><span class="sh">'</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">portfolio_summary</span><span class="p">,</span><span class="n">portfolio</span>
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="n">summary</span> <span class="o">=</span> <span class="nf">dict</span><span class="p">()</span>
<span class="n">summary</span><span class="p">[</span><span class="sh">'</span><span class="s">MonteCarlo</span><span class="sh">'</span><span class="p">],</span><span class="n">mc</span> <span class="o">=</span> <span class="nf">portfolio_returns</span><span class="p">(</span><span class="n">mc_portfolios</span><span class="p">)</span>
<span class="n">summary</span><span class="p">[</span><span class="sh">'</span><span class="s">Balanced</span><span class="sh">'</span><span class="p">],</span><span class="n">_</span> <span class="o">=</span> <span class="nf">portfolio_returns</span><span class="p">(</span><span class="n">balanced_portfolio</span><span class="p">)</span>
</pre></table></code></div></div><p><strong><em>Results</em></strong></p><p>Figure 2 below illustrates the results and relationship between each randomised portfolios (grey dots) risk and investment return (%). The orange dot is the balance portfolio.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2020-08-04-portfolios-fig2.png" alt="png" /></p><p>The green dot is the portfolio with the greatest Sharpe ratio, that is the portfolio with lowest risk in relation to the level of return in excess of the risk free rate. We see that this portfolio has a blend of investments in “Deep Impact” 9% and “Jumanji Inc” 81 %.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="c1"># Max Sharpe portfolio 
</span><span class="n">mc</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mc</span><span class="p">[</span><span class="sh">'</span><span class="s">p</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="n">summary</span><span class="p">[</span><span class="sh">'</span><span class="s">MonteCarlo</span><span class="sh">'</span><span class="p">].</span><span class="n">sharpe</span><span class="p">.</span><span class="nf">idxmax</span><span class="p">()]</span>
</pre></table></code></div></div><div><style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; }</style><table border="1" class="dataframe"><thead><tr style="text-align: right;"><th><th>n<th>name<th>price<th>mu<th>sigma<th>value<th>shares<th>p<th>result<th>var<tbody><tr><th>9164<td>6<td>deep impact<td>20<td>0.02<td>5<td>187.602982<td>9.380149<td>2037<td>-18.592925<td>25<tr><th>9165<td>0<td>jumanji inc<td>10<td>0.10<td>10<td>812.397018<td>81.239702<td>2037<td>1747.558702<td>100</table></div><p><strong><em>Conclusion</em></strong></p><ul><li>This method applies monte carlo (i.e. exhaustive search) to calculate a large number of randomised investment portfolios.<li>Risk, Return, and Sharpe measures are calculated for each of the random portfolios, and for a balanced portfolio (i.e. equal allocation portfolio assuming no knowledge of where to invest).<li>An optimal portfolio is identified using the maximum Sharpe ratio that maximises returns whilst minimising risk.<li>Increasing the number of randomised portfolios increases the chances of identifying an optimal portfolio.<li>However, finding the optimal portfolio is not garunteed. The likelihood of identifying the most optimal portfolio decreases with increasing number of investment options, and higher degrees of uncertainty of the investment returns and variances.</ul><p>Thank you for reading. Next time I will run through a more sophisticated optimisation technique using Machine Learning. You can find the code to replicate the above analysis on my <a href="https://github.com/bpostance">Github account here</a></p><h2 id="references">References</h2><hr /><ul><li>https://towardsdatascience.com/optimization-with-python-how-to-make-the-most-amount-of-money-with-the-least-amount-of-risk-1ebebf5b2f29<li>https://colab.research.google.com/github/cvxgrp/cvx_short_course/blob/master/applications/portfolio_optimization.ipynb<li>https://insightr.wordpress.com/2017/08/27/pricing-optimization-how-to-find-the-price-that-maximizes-your-profit/<li>http://riskdatascience.net/usecases-auswahl/automated-portfolio-optimization-by-combining-ai-and-risk-methods/<li>https://towardsdatascience.com/automating-portfolio-optimization-using-python-9f344b9380b9<li>https://towardsdatascience.com/best-investment-portfolio-via-monte-carlo-simulation-in-python-53286f3fe93<li>https://www.dummies.com/business/accounting/auditing/how-to-optimize-portfolio-risk/</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/blog-post/'>blog-post</a>, <a href='/categories/data-analysis/'>data-analysis</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/optimisation/" class="post-tag no-text-decoration" >optimisation</a> <a href="/tags/monte-carlo/" class="post-tag no-text-decoration" >monte carlo</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Portfolio Optimisation: Monte Carlo method - Ben Postance&url=https://bpostance.github.io/posts/optimisation-monte-carlo/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Portfolio Optimisation: Monte Carlo method - Ben Postance&u=https://bpostance.github.io/posts/optimisation-monte-carlo/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Portfolio Optimisation: Monte Carlo method - Ben Postance&url=https://bpostance.github.io/posts/optimisation-monte-carlo/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/building-ai-enterprise/">How to build an Advanced Analytics function</a><li><a href="/posts/multi-tasking-in-python/">Multi-tasking in Python</a><li><a href="/posts/airflow-taskflow/">Writing Pythonic Airflow DAGs with the TaskFlow API</a><li><a href="/posts/finCEN/">The finCEN files: Uncovering money laundering patterns in the global banking network</a><li><a href="/posts/working-with-MODIS-data/">Geospatial Analysis: Working with MODIS data</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/bayes-theory/">bayes-theory</a> <a class="post-tag" href="/tags/bayesian-inference/">bayesian-inference</a> <a class="post-tag" href="/tags/data-mining/">data-mining</a> <a class="post-tag" href="/tags/monte-carlo/">monte carlo</a> <a class="post-tag" href="/tags/classification/">classification</a> <a class="post-tag" href="/tags/clustering/">clustering</a> <a class="post-tag" href="/tags/data-cleaning/">data-cleaning</a> <a class="post-tag" href="/tags/decomposition/">decomposition</a> <a class="post-tag" href="/tags/dimension-reduction/">dimension-reduction</a> <a class="post-tag" href="/tags/geospatial-analysis/">geospatial-analysis</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/introduction-to-bayesian-inference/"><div class="card-body"> <span class="timeago small" > Dec 13, 2020 <i class="unloaded">2020-12-13T18:00:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Bayesian Inference by hand</h3><div class="text-muted small"><p> image source Jupyter notebook here Bayesian inference is a statistical method used to update one’s beliefs about a process or system upon observing data. It has wide reaching applications from...</p></div></div></a></div><div class="card"> <a href="/posts/glm-deep-dive/"><div class="card-body"> <span class="timeago small" > May 17, 2020 <i class="unloaded">2020-05-17T19:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>A deep dive on GLM's in frequency severity models</h3><div class="text-muted small"><p> Jupyter notebook here This notebook is a deep dive into General Linear Models (GLM’s) with a focus on the GLM’s used in insurance risk modeling and pricing (Yan, J. 2010).I have used GLM’s befor...</p></div></div></a></div><div class="card"> <a href="/posts/finCEN/"><div class="card-body"> <span class="timeago small" > Sep 21, 2020 <i class="unloaded">2020-09-21T19:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>The finCEN files: Uncovering money laundering patterns in the global banking network</h3><div class="text-muted small"><p> Jupyter notebook here The Financial Crimes Enforcement Network (finCEN) files are more than 2,500 documents, most of which were suspicious activity reports (SARs) files that banks sent to the US ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/glm-deep-dive/" class="btn btn-outline-primary" prompt="Older"><p>A deep dive on GLM's in frequency severity models</p></a> <a href="/posts/working-with-MODIS-data/" class="btn btn-outline-primary" prompt="Newer"><p>Geospatial Analysis: Working with MODIS data</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//https-bpostance-github-io.disqus.com/embed.js', disqusConfig: function() { this.page.title = 'Portfolio Optimisation: Monte Carlo method'; this.page.url = 'https://bpostance.github.io/posts/optimisation-monte-carlo/'; this.page.identifier = '/posts/optimisation-monte-carlo/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/username">BenPostance</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."> Some rights reserved. </span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/bayes-theory/">bayes theory</a> <a class="post-tag" href="/tags/bayesian-inference/">bayesian inference</a> <a class="post-tag" href="/tags/data-mining/">data mining</a> <a class="post-tag" href="/tags/monte-carlo/">monte carlo</a> <a class="post-tag" href="/tags/classification/">classification</a> <a class="post-tag" href="/tags/clustering/">clustering</a> <a class="post-tag" href="/tags/data-cleaning/">data cleaning</a> <a class="post-tag" href="/tags/decomposition/">decomposition</a> <a class="post-tag" href="/tags/dimension-reduction/">dimension reduction</a> <a class="post-tag" href="/tags/geospatial-analysis/">geospatial analysis</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#top" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://bpostance.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
