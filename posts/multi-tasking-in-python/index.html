<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Multi-tasking in Python" /><meta name="author" content="Ben Postance" /><meta property="og:locale" content="en_US" /><meta name="description" content="In computing systems, multitasking refers to the concurrent execution of tasks and processes, allowing resources to be allocated to multiple tasks simultaneously." /><meta property="og:description" content="In computing systems, multitasking refers to the concurrent execution of tasks and processes, allowing resources to be allocated to multiple tasks simultaneously." /><link rel="canonical" href="https://bpostance.github.io/posts/multi-tasking-in-python/" /><meta property="og:url" content="https://bpostance.github.io/posts/multi-tasking-in-python/" /><meta property="og:site_name" content="Ben Postance" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-01-04T18:00:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Multi-tasking in Python" /><meta name="twitter:site" content="@benpostance" /><meta name="twitter:creator" content="@Ben Postance" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Ben Postance"},"dateModified":"2025-02-12T13:49:00+00:00","datePublished":"2022-01-04T18:00:00+00:00","description":"In computing systems, multitasking refers to the concurrent execution of tasks and processes, allowing resources to be allocated to multiple tasks simultaneously.","headline":"Multi-tasking in Python","mainEntityOfPage":{"@type":"WebPage","@id":"https://bpostance.github.io/posts/multi-tasking-in-python/"},"url":"https://bpostance.github.io/posts/multi-tasking-in-python/"}</script><title>Multi-tasking in Python | Ben Postance</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-140894462-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-140894462-1'); }); </script><body data-spy="scroll" data-target="#toc"><div id="top"></div><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/7165735?s=460&u=7ca34b8152bbff087bfc860cc87a4c35b4f9cb1b&v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Ben Postance</a></div><div class="site-subtitle font-italic">Risk, Data Science and Machine Learning</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT ME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/bpostance" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/benpostance" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['benpostance','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Multi-tasking in Python</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Multi-tasking in Python</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Ben Postance </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Jan 4, 2022, 6:00 PM +0000" prep="on" > Jan 4, 2022 <i class="unloaded">2022-01-04T18:00:00+00:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Wed, Feb 12, 2025, 1:49 PM +0000" prefix="Updated " > Feb 12 <i class="unloaded">2025-02-12T13:49:00+00:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1846 words">10 min</span></div></div><div class="post-content"><p>In computing systems, multitasking refers to the concurrent execution of tasks and processes, allowing resources to be allocated to multiple tasks simultaneously.</p><p>In data engineering, analytics, and data science, we often encounter scenarios where optimising execution speed is essential. Some problems are addressed by data processing and modelling techniques, such as map-reduce or distributed data processing on Apache Spark. However, other tasks may be time-consuming due to the volume of operations, such as obtaining data via API calls or web scraping, loading and processing data in files, or updating reactive visualisations and dashboards.</p><p>In these situations, threading and multiprocessing techniques can be employed to run tasks concurrently.</p><h2 id="synchronous--asynchronous-execution">Synchronous &amp; Asynchronous execution</h2><div> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2022-01-04-multi-tasking/parallel-processing.png" width="90%" height="90%" /></div><p>Python code can run in one of two “worlds”, synchronous and asynchronous.</p><p>The synchronous world is our typical day to day python. In the synchronous world tasks and jobs are run one after the other on threads. The only option to multi-task here is to use multiple execution threads - covered below in <a href="#other-methods">Other Methods</a>.</p><p>The asynchronous world is in a whole different space with different libraries and routines. In asynchronous tasks are run concurrently on a central <a href="https://docs.python.org/3/library/asyncio-eventloop.html">event loop</a>. The event loop is the core of every asyncio application. Event loops run asynchronous tasks and callbacks, perform network IO operations, and run sub-processes.</p><p>Given the two worlds there are a few different execution patterns with which we call synchronous and asynchronous functions:</p><ol><li>Sync: This is just regular python functions that run sequentially.<li>Async: Use async functions that can be run as concurrent tasks.<li>Async execution of Sync: We don’t want to be limited to just using async specific functions. In some cases it is possible to run sync functions asynchronously.</ol><p>We don’t need to cover Sync here so lets jump straight to point 2 Async.</p><h3 id="async">Async</h3><p>Async functions can be used directly with <code class="language-plaintext highlighter-rouge">await/async</code> functionality.</p><p>Below is a example async task “coroutine” to sleep. Note that instead of using the standard <code class="language-plaintext highlighter-rouge">time.sleep()</code> it uses the async compatible <code class="language-plaintext highlighter-rouge">asyncio.sleep()</code> function.</p><blockquote><p><strong>NOTE Jupyter Notebooks</strong>:</p><p>If you’re using IPython or Jupyter Notebooks, you must invoke <code class="language-plaintext highlighter-rouge">async main()</code> functions with <code class="language-plaintext highlighter-rouge">await main()</code>. If you’re using python shell use <code class="language-plaintext highlighter-rouge">asyncio.run(main())</code>.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre># example.py
  import asyncio
  import time

  ## multiple task
  async def say_hello(name):
      await asyncio.sleep(3)
      print("Hello-%s" % name)

   async def main():
       await say_hello("Ben")
       await say_hello("Jenny")

   start_time = time.time()
   asyncio.run(main())
   print(f"--- {time.time() - start_time:.5f} seconds ---\n\r")
</pre></table></code></div></div></blockquote><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">asyncio</span>

<span class="c1"># single task
</span><span class="k">async</span> <span class="k">def</span> <span class="nf">say_hello</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Hello-%s</span><span class="sh">"</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">await</span> <span class="nf">say_hello</span><span class="p">(</span><span class="sh">"</span><span class="s">Ben</span><span class="sh">"</span><span class="p">)</span>

<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
<span class="k">await</span> <span class="nf">main</span><span class="p">()</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">--- </span><span class="si">{</span><span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="si">:</span><span class="p">.</span><span class="mi">5</span><span class="n">f</span><span class="si">}</span><span class="s"> seconds ---</span><span class="se">\n\r</span><span class="sh">"</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>Hello-Ben
--- 3.00425 seconds ---
</pre></table></code></div></div><p>OK, now let’s add another task.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="c1">## multiple task
</span><span class="k">async</span> <span class="k">def</span> <span class="nf">say_hello</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Hello-%s</span><span class="sh">"</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">await</span> <span class="nf">say_hello</span><span class="p">(</span><span class="sh">"</span><span class="s">Ben</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">await</span> <span class="nf">say_hello</span><span class="p">(</span><span class="sh">"</span><span class="s">Jenny</span><span class="sh">"</span><span class="p">)</span>

<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
<span class="k">await</span> <span class="nf">main</span><span class="p">()</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">--- </span><span class="si">{</span><span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="si">:</span><span class="p">.</span><span class="mi">5</span><span class="n">f</span><span class="si">}</span><span class="s"> seconds ---</span><span class="se">\n\r</span><span class="sh">"</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>Hello-Ben
Hello-Jenny
--- 6.00553 seconds ---
</pre></table></code></div></div><p>But hang on, that took 6 seconds. The tasks are still being executed in sync.</p><p>This is expected as, although we are using asynchronous functions, we are still “awaiting” on them to complete sequentially “in sync”.</p><p>The <a href="https://docs.python.org/3/library/asyncio-task.html">asyncio concurrency documentation</a> explains the primary two ways to execute concurrent tasks.</p><p>First, we can explicitly build await coroutines.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="c1">## multiple task
</span><span class="k">async</span> <span class="k">def</span> <span class="nf">say_hello</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Hello-%s</span><span class="sh">"</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">first_task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">create_task</span><span class="p">(</span><span class="nf">say_hello</span><span class="p">(</span><span class="sh">"</span><span class="s">Ben</span><span class="sh">"</span><span class="p">))</span>
    <span class="n">second_task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">create_task</span><span class="p">(</span><span class="nf">say_hello</span><span class="p">(</span><span class="sh">"</span><span class="s">Jenny</span><span class="sh">"</span><span class="p">))</span>
    <span class="k">await</span> <span class="n">first_task</span>
    <span class="k">await</span> <span class="n">second_task</span>

<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
<span class="k">await</span> <span class="nf">main</span><span class="p">()</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">--- </span><span class="si">{</span><span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="si">:</span><span class="p">.</span><span class="mi">5</span><span class="n">f</span><span class="si">}</span><span class="s"> seconds ---</span><span class="se">\n\r</span><span class="sh">"</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>Hello-Ben
Hello-Jenny
--- 3.00403 seconds ---
</pre></table></code></div></div><p>Neat, now our two 3 second operations are completed in 3 seconds. Not 6.</p><p>The second way to declare async/await coroutines is using <a href="https://docs.python.org/3/library/asyncio-task.html#waiting-primitives">waiting primitives</a>.</p><p>Below is another simple waiting function, but also with an Input/Output pattern and using <code class="language-plaintext highlighter-rouge">asyncio.wait()</code> to create each task dynamically.</p><p>Note how the total time taken to execute the tasks is equal to the highest time the function waits for. There is also a timeout argument - and this might be handy if making API or web scraping calls for instance. Try changing it to a value less that 9.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="n">list_items</span> <span class="o">=</span> <span class="nf">list</span><span class="p">()</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">slow_calculation</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">list_items</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">Waiting </span><span class="si">{</span><span class="n">wait</span><span class="si">}</span><span class="s">....</span><span class="sh">'</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="n">wait</span><span class="p">)</span>
    <span class="n">list_items</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">wait</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
     <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">wait</span><span class="p">([</span>
                         <span class="nf">slow_calculation</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
                        <span class="p">],</span><span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
<span class="k">await</span> <span class="nf">main</span><span class="p">()</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">--- </span><span class="si">{</span><span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="si">:</span><span class="p">.</span><span class="mi">5</span><span class="n">f</span><span class="si">}</span><span class="s"> seconds ---</span><span class="se">\n\r</span><span class="sh">"</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">List items:</span><span class="se">\t</span><span class="si">{</span><span class="n">list_items</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>Waiting 9....
Waiting 2....
Waiting 4....
Waiting 8....
Waiting 3....
Waiting 7....
Waiting 5....
Waiting 1....
Waiting 6....
--- 9.00256 seconds ---

List items:	[1, 2, 3, 4, 5, 6, 7, 8, 9]
</pre></table></code></div></div><h3 id="sync-to-async">Sync to Async</h3><p>Here is a simple sync function to sleep - as you can see it takes some time to run each task.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="n">list_items</span> <span class="o">=</span> <span class="nf">list</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">slow_calculation</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">list_items</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">Waiting </span><span class="si">{</span><span class="n">wait</span><span class="si">}</span><span class="s">....</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="n">wait</span><span class="p">)</span>
    <span class="n">list_items</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">wait</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="p">[</span><span class="nf">slow_calculation</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)]</span>

<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
<span class="nf">main</span><span class="p">()</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">--- </span><span class="si">{</span><span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="si">:</span><span class="p">.</span><span class="mi">5</span><span class="n">f</span><span class="si">}</span><span class="s"> seconds ---</span><span class="se">\n\r</span><span class="sh">"</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">List items:</span><span class="se">\t</span><span class="si">{</span><span class="n">list_items</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>Waiting 1....
Waiting 2....
Waiting 3....
Waiting 4....
--- 10.00870 seconds ---

List items:	[1, 2, 3, 4]
</pre></table></code></div></div><p>And here, we use a combination of <code class="language-plaintext highlighter-rouge">ThreadPool</code> execution and <code class="language-plaintext highlighter-rouge">async</code> to run each task concurrently using threads.</p><p>The <code class="language-plaintext highlighter-rouge">workers</code> specifies the number of threads to use - try setting this to 1.</p><p>Alternatively, set the executor argument to <code class="language-plaintext highlighter-rouge">None</code> in <code class="language-plaintext highlighter-rouge">loop.run_in_executor(None,...</code> to default to the number of processors on the machine, multiplied by 5 <a href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.ThreadPoolExecutor">(documentation)</a>.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span>

<span class="n">workers</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">list_items</span> <span class="o">=</span> <span class="nf">list</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">slow_calculation</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">list_items</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">Waiting </span><span class="si">{</span><span class="n">wait</span><span class="si">}</span><span class="s">....</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="n">wait</span><span class="p">)</span>
    <span class="n">list_items</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">wait</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">executor</span> <span class="o">=</span> <span class="nc">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">workers</span><span class="p">)</span>
    <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">get_event_loop</span><span class="p">()</span>
    <span class="n">futures</span> <span class="o">=</span>  <span class="p">[</span><span class="n">loop</span><span class="p">.</span><span class="nf">run_in_executor</span><span class="p">(</span><span class="n">executor</span><span class="p">,</span> <span class="n">slow_calculation</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)]</span>
    <span class="c1"># futures =  [loop.run_in_executor(None, slow_calculation, i) for i in np.arange(1,5)]
</span>    <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">gather</span><span class="p">(</span><span class="o">*</span><span class="n">futures</span><span class="p">)</span>

<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
<span class="k">await</span> <span class="nf">main</span><span class="p">()</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">--- </span><span class="si">{</span><span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="si">:</span><span class="p">.</span><span class="mi">5</span><span class="n">f</span><span class="si">}</span><span class="s"> seconds ---</span><span class="se">\n\r</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">List items:</span><span class="se">\t</span><span class="si">{</span><span class="n">list_items</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>Waiting 1....
Waiting 2....
Waiting 3....
Waiting 4....
--- 4.00656 seconds ---

List items:	[1, 2, 3, 4]
</pre></table></code></div></div><p>That concludes this introduction to asynchronous python routines.</p><h2 id="other-methods">Other methods</h2><p>Here are some other ways to multi-task in python.</p><h3 id="threading">threading</h3><p>The <code class="language-plaintext highlighter-rouge">threading</code> package is used to enable more explicit control of a thread process. This approach can be useful when waiting on the result of a slow or external process such as an API call or database query.</p><p>A <code class="language-plaintext highlighter-rouge">slow_calculation</code> function updating a global variable <code class="language-plaintext highlighter-rouge">result</code> and <code class="language-plaintext highlighter-rouge">thread.join()</code> is used to ensure that the slow function completes before progressing.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">threading</span>
<span class="n">result</span> <span class="o">=</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">slow_calculation</span><span class="p">():</span>
    
    <span class="c1"># here goes some long calculation
</span>    <span class="n">rand</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">high</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">Waiting </span><span class="si">{</span><span class="n">rand</span><span class="si">}</span><span class="s">....</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="n">rand</span><span class="p">)</span>
   
    <span class="c1"># when the calculation is done, the result is stored in a global variable
</span>    <span class="k">global</span> <span class="n">result</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">rand</span><span class="o">**</span><span class="mi">2</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">thread</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="nc">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="nf">slow_calculation</span><span class="p">())</span>
    <span class="n">thread</span><span class="p">.</span><span class="nf">start</span><span class="p">()</span>
 
    <span class="c1"># dont do this
</span>    <span class="c1"># while result is None:
</span>    <span class="c1">#     pass
</span>    
    <span class="c1"># Do this, wait here for the result to be available before continuing
</span>    <span class="n">thread</span><span class="p">.</span><span class="nf">join</span><span class="p">()</span>
   
    <span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">The result is</span><span class="sh">'</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    
<span class="nf">main</span><span class="p">()</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>Waiting 3....
The result is 9
</pre></table></code></div></div><p>Below is a similar, but this time instead of waiting for the whole slow function to complete we use an event <code class="language-plaintext highlighter-rouge">result_available = threading.Event()</code> to trigger the continuation of the thread.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="n">result</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">result_available</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="nc">Event</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">slow_calculation</span><span class="p">():</span>
    
    <span class="c1"># here goes some long calculation
</span>    <span class="n">rand</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">high</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">Waiting </span><span class="si">{</span><span class="n">rand</span><span class="si">}</span><span class="s">....</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="n">rand</span><span class="p">)</span>
   
    <span class="c1"># when the calculation is done, the result is stored in a global variable
</span>    <span class="k">global</span> <span class="n">result</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">rand</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">result_available</span><span class="p">.</span><span class="nf">set</span><span class="p">()</span>
    
    <span class="c1"># do some more work before exiting the thread
</span>    <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">thread finished</span><span class="sh">'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">thread</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="nc">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="nf">slow_calculation</span><span class="p">())</span>
    <span class="n">thread</span><span class="p">.</span><span class="nf">start</span><span class="p">()</span>
 
    <span class="c1"># wait here for the result to be available before continuing
</span>    <span class="n">result_available</span><span class="p">.</span><span class="nf">wait</span><span class="p">()</span>
   
    <span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">The result is</span><span class="sh">'</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    
<span class="nf">main</span><span class="p">()</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>Waiting 4....
thread finished
The result is 16
</pre></table></code></div></div><p>Finally, let’s look at running multiple threads concurrently now that we understand how threads operate and can be controlled.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">concurrent.futures</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">time</span>

<span class="n">list_items</span><span class="o">=</span><span class="nf">list</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">slow_calculation</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="c1"># here goes some long calculation
</span>    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">Waiting </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">....</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
   
    <span class="c1"># when the calculation is done, the result is stored in a global variable
</span>    <span class="k">global</span> <span class="n">list_items</span>
    <span class="n">list_items</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">i</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
<span class="k">with</span> <span class="n">concurrent</span><span class="p">.</span><span class="n">futures</span><span class="p">.</span><span class="nc">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
    <span class="n">executor</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="n">slow_calculation</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="nf">print</span><span class="p">(</span><span class="n">list_items</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">--- </span><span class="si">{</span><span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="si">:</span><span class="p">.</span><span class="mi">5</span><span class="n">f</span><span class="si">}</span><span class="s"> seconds ---</span><span class="se">\n\r</span><span class="sh">"</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>Waiting 1....
Waiting 2....
Waiting 3....
Waiting 4....
[1, 4, 9, 16]
--- 4.00680 seconds --
</pre></table></code></div></div><h3 id="multiprocessing">multiprocessing</h3><p>The <a href="https://docs.python.org/3/library/multiprocessing.html">multiprocessing</a> package supports spawning processes similar to the threading module. Multiprocessing does this by spawning sub-processes that allows users to leverage multiple processors at simultaneously.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>

<span class="n">list_items</span><span class="o">=</span><span class="nf">list</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">slow_calculation</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">list_items</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">Waiting </span><span class="si">{</span><span class="n">wait</span><span class="si">}</span><span class="s">....</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="n">wait</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wait</span>

<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>

<span class="n">result_objs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">with</span> <span class="nc">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">os</span><span class="p">.</span><span class="nf">cpu_count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">pool</span><span class="p">.</span><span class="nf">apply_async</span><span class="p">(</span><span class="n">slow_calculation</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,))</span>
        <span class="n">result_objs</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="n">list_items</span> <span class="o">=</span> <span class="p">[</span><span class="n">result</span><span class="p">.</span><span class="nf">get</span><span class="p">()</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">result_objs</span><span class="p">]</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">--- </span><span class="si">{</span><span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="si">:</span><span class="p">.</span><span class="mi">5</span><span class="n">f</span><span class="si">}</span><span class="s"> seconds ---</span><span class="se">\n\r</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">List items:</span><span class="se">\t</span><span class="si">{</span><span class="n">list_items</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>Waiting 1....Waiting 4....

Waiting 3....
Waiting 2....
--- 4.16348 seconds ---

List items:	[1, 2, 3, 4]
</pre></table></code></div></div><h3 id="pyrallel">pyrallel</h3><p><a href="https://pyrallel.readthedocs.io/en/latest/parallel_processor.html">PyRallel</a> is another ParallelProcessor that uses CPU cores to process compute-intensive tasks. It is similar to multiprocessing.</p><p>There is relatively little/no documentation on PyRallel beyond the <a href="https://pyrallel.readthedocs.io/en/latest/parallel_processor.html">official documentation</a>. There is also an unrelated and deprecated predecessor to Dask with the <a href="https://github.com/pydata/pyrallel">same name</a> - so expect little help. But it also has as a <code class="language-plaintext highlighter-rouge">MapReduce</code> and <code class="language-plaintext highlighter-rouge">Queue</code> function that looks interesting and that i’ll check out at some point.</p><p>To install:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre># conda 
# from the auto channel https://anaconda.org/auto/pyrallel
conda install -c auto pyrallel

# pip 
# https://pyrallel.readthedocs.io/en/latest/installation.html
pip install pyrallel.lib
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">pyrallel</span> <span class="kn">import</span> <span class="n">ParallelProcessor</span>

<span class="n">list_items</span><span class="o">=</span><span class="nf">list</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">slow_calculation</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">Waiting </span><span class="si">{</span><span class="n">wait</span><span class="si">}</span><span class="s">....</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="n">wait</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wait</span>

<span class="k">def</span> <span class="nf">collector</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">list_items</span>
    <span class="n">list_items</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>

<span class="n">pp</span> <span class="o">=</span> <span class="nc">ParallelProcessor</span><span class="p">(</span><span class="n">num_of_processor</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">mapper</span><span class="o">=</span><span class="n">slow_calculation</span><span class="p">,</span><span class="n">collector</span><span class="o">=</span><span class="n">collector</span><span class="p">)</span>
<span class="n">pp</span><span class="p">.</span><span class="nf">start</span><span class="p">()</span>
<span class="n">pp</span><span class="p">.</span><span class="nf">map</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)])</span>
<span class="n">pp</span><span class="p">.</span><span class="nf">task_done</span><span class="p">()</span>
<span class="n">pp</span><span class="p">.</span><span class="nf">join</span><span class="p">()</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">--- </span><span class="si">{</span><span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="si">:</span><span class="p">.</span><span class="mi">5</span><span class="n">f</span><span class="si">}</span><span class="s"> seconds ---</span><span class="se">\n\r</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">List items:</span><span class="se">\t</span><span class="si">{</span><span class="n">list_items</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>Waiting 1....
Waiting 4....
Waiting 2....
Waiting 3....
--- 5.20214 seconds ---

List items:	[1, 2, 3, 4]
</pre></table></code></div></div><p>Thank you for reading</p><h2 id="references">References</h2><ul><li>https://www.aeracode.org/2018/02/19/python-async-simplified/<li>https://e2eml.school/multiprocessing.html<li>https://pyrallel.readthedocs.io/en/latest/parallel_processor.html<li>https://www.aeracode.org/2018/02/19/python-async-simplified/</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/blog-post/'>blog-post</a>, <a href='/categories/engineering/'>engineering</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/parallel-processing/" class="post-tag no-text-decoration" >parallel-processing</a> <a href="/tags/multi-threading/" class="post-tag no-text-decoration" >multi-threading</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Multi-tasking in Python - Ben Postance&url=https://bpostance.github.io/posts/multi-tasking-in-python/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Multi-tasking in Python - Ben Postance&u=https://bpostance.github.io/posts/multi-tasking-in-python/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Multi-tasking in Python - Ben Postance&url=https://bpostance.github.io/posts/multi-tasking-in-python/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/building-ai-enterprise/">How to build an Advanced Analytics function</a><li><a href="/posts/multi-tasking-in-python/">Multi-tasking in Python</a><li><a href="/posts/airflow-taskflow/">Writing Pythonic Airflow DAGs with the TaskFlow API</a><li><a href="/posts/finCEN/">The finCEN files: Uncovering money laundering patterns in the global banking network</a><li><a href="/posts/working-with-MODIS-data/">Geospatial Analysis: Working with MODIS data</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/bayes-theory/">bayes-theory</a> <a class="post-tag" href="/tags/bayesian-inference/">bayesian-inference</a> <a class="post-tag" href="/tags/data-mining/">data-mining</a> <a class="post-tag" href="/tags/monte-carlo/">monte carlo</a> <a class="post-tag" href="/tags/classification/">classification</a> <a class="post-tag" href="/tags/clustering/">clustering</a> <a class="post-tag" href="/tags/data-cleaning/">data-cleaning</a> <a class="post-tag" href="/tags/decomposition/">decomposition</a> <a class="post-tag" href="/tags/dimension-reduction/">dimension-reduction</a> <a class="post-tag" href="/tags/geospatial-analysis/">geospatial-analysis</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/working-with-MODIS-data/"><div class="card-body"> <span class="timeago small" > Sep 1, 2020 <i class="unloaded">2020-09-01T19:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Geospatial Analysis: Working with MODIS data</h3><div class="text-muted small"><p> Jupyter notebook here The Moderate Resolution Imaging Spectroradiometer (MODIS) is an imaging sensor built by Santa Barbara Remote Sensing that was launched into Earth orbit by NASA in 1999 on b...</p></div></div></a></div><div class="card"> <a href="/posts/processing-large-spatial-datasets.md/"><div class="card-body"> <span class="timeago small" > May 20, 2021 <i class="unloaded">2021-05-20T19:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Geospatial Analysis: obtaining and pre-processing OpenSource satellite data</h3><div class="text-muted small"><p> This notebook demonstrates how to obtain and pre-process satellite data from from NASA LP DAAC - Land Processes Distributed Active Archive Center. I will show how to process LP DAAC datasets into c...</p></div></div></a></div><div class="card"> <a href="/posts/hello-world/"><div class="card-body"> <span class="timeago small" > May 23, 2019 <i class="unloaded">2019-05-23T21:56:21+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hello Jekyll!</h3><div class="text-muted small"><p> Hello and welcome to my new Research and DataScience portfolio page. Update March 2021 I have now adopted the Chirpy theme. On this site I’ll be posting links to projects, demo’s and training mat...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/building-ai-enterprise/" class="btn btn-outline-primary" prompt="Older"><p>How to build an Advanced Analytics function</p></a> <a href="/posts/airflow-taskflow/" class="btn btn-outline-primary" prompt="Newer"><p>Writing Pythonic Airflow DAGs with the TaskFlow API</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//https-bpostance-github-io.disqus.com/embed.js', disqusConfig: function() { this.page.title = 'Multi-tasking in Python'; this.page.url = 'https://bpostance.github.io/posts/multi-tasking-in-python/'; this.page.identifier = '/posts/multi-tasking-in-python/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/username">BenPostance</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."> Some rights reserved. </span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/bayes-theory/">bayes theory</a> <a class="post-tag" href="/tags/bayesian-inference/">bayesian inference</a> <a class="post-tag" href="/tags/data-mining/">data mining</a> <a class="post-tag" href="/tags/monte-carlo/">monte carlo</a> <a class="post-tag" href="/tags/classification/">classification</a> <a class="post-tag" href="/tags/clustering/">clustering</a> <a class="post-tag" href="/tags/data-cleaning/">data cleaning</a> <a class="post-tag" href="/tags/decomposition/">decomposition</a> <a class="post-tag" href="/tags/dimension-reduction/">dimension reduction</a> <a class="post-tag" href="/tags/geospatial-analysis/">geospatial analysis</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#top" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://bpostance.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
